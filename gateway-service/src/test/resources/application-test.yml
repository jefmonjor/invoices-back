server:
  port: 0 # Random port for tests

spring:
  application:
    name: gateway-service

  cloud:
    gateway:
      globalcors:
        cors-configurations:
          '[/**]':
            allowed-origins: "http://localhost:3000,http://localhost:5173,http://test.com"
            allowed-methods: "GET,POST,PUT,DELETE,OPTIONS"
            allowed-headers: "*"
            allow-credentials: true
            max-age: 3600

      routes:
        - id: auth-service
          uri: lb://user-service
          predicates:
            - Path=/api/auth/**
          filters:
            - RewritePath=/api/auth/(?<segment>.*), /api/auth/$\{segment}

        - id: user-service
          uri: lb://user-service
          predicates:
            - Path=/api/users/**

        - id: invoice-service
          uri: lb://invoice-service
          predicates:
            - Path=/api/invoices/**

        - id: document-service
          uri: lb://document-service
          predicates:
            - Path=/api/documents/**

        - id: trace-service
          uri: lb://trace-service
          predicates:
            - Path=/api/traces/**

      default-filters:
        - DedupeResponseHeader=Access-Control-Allow-Credentials Access-Control-Allow-Origin

# Disable Eureka for tests
eureka:
  client:
    enabled: false

# JWT Configuration for tests
jwt:
  secret: "test-secret-key-for-jwt-validation-that-is-long-enough-32-chars-minimum"
  issuer: "test-issuer"

# Public paths
security:
  public-paths:
    - /api/auth/**
    - /actuator/**
    - /swagger-ui/**
    - /api-docs/**

logging:
  level:
    root: INFO
    com.invoices: DEBUG
    org.springframework.cloud.gateway: INFO
