# Production configuration
spring:
  config:
    activate:
      on-profile: prod

# Application base URL for security.txt and other services
app:
  base-url: ${APP_BASE_URL:https://transolido.com}
  security:
    contact-email: ${APP_SECURITY_CONTACT_EMAIL:security@transolido.com}
  
  # WebSocket configuration
  websocket:
    allowed-origins: ${ALLOWED_ORIGINS:https://yourdomain.com}

  # Memory Optimization: DB Pool
  datasource:
    hikari:
      maximum-pool-size: 5  # Neon pooler handles connection multiplexing
      minimum-idle: 2
      idle-timeout: 300000        # 5 min
      connection-timeout: 20000   # 20 sec
      max-lifetime: 600000        # 10 min - less than Neon's timeout
      validation-timeout: 5000
      leak-detection-threshold: 60000  # 1 min - detect connection leaks

  # Disable lazy initialization for predictable performance
  main:
    lazy-initialization: false

# Disable Swagger UI in production (security best practice)
springdoc:
  swagger-ui:
    enabled: false
  api-docs:
    enabled: false

# VeriFactu AEAT Production Endpoint
verifactu:
  mode: PRODUCTION
  keystore:
    path: ${VERIFACTU_KEYSTORE_PATH:/app/keystore.jks}
    password: ${VERIFACTU_KEYSTORE_PASSWORD}
    alias: ${VERIFACTU_KEYSTORE_ALIAS:verifactu}
  aeat:
    endpoint-production: https://www2.agenciatributaria.gob.es/wlpl/TIKE-CONT/ws/SuministroInformacion
    timeout: 30000

# Production Logging - reduced verbosity for performance
logging:
  level:
    root: WARN
    com.invoices: INFO
    org.springframework: WARN
    org.springframework.web: WARN
    org.hibernate: WARN
    org.hibernate.SQL: WARN
    org.hibernate.stat: OFF
    com.zaxxer.hikari: WARN
    io.lettuce: WARN
    io.minio: WARN

# Server tuning for production
server:
  tomcat:
    threads:
      max: 50        # Reduced from 200, saves ~75MB stack memory
      min-spare: 5
    connection-timeout: 20000
    max-connections: 1000
    accept-count: 100
