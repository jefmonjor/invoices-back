<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <title th:text="'Factura ' + ${invoice.invoiceNumber}">Factura</title>
    <link rel="stylesheet" href="../static/css/invoice-styles.css" th:href="@{/css/invoice-styles.css}" />
</head>

<body>
    <div class="container">
        <!-- Header: Logo | Company | QR - NO BORDERS -->
        <div class="header-section">
            <div class="logo-space">
                <!-- Future: Company logo -->
            </div>
            <div class="company-info">
                <span class="company-name" th:text="${company.businessName}">EMPRESA S.L.</span>
                <span class="company-nif" th:text="${company.taxId}">B12345678</span>
                <span class="company-address"
                    th:text="${company.address + ', ' + company.postalCode + ' ' + company.city + ' (' + company.province + ')'}">Dirección</span>
                <span class="company-address" th:if="${company.phone}" th:text="${company.phone}">Teléfono</span>
            </div>
            <div class="qr-space">
                <!-- Future: QR Code -->
            </div>
        </div>

        <!-- Invoice Meta - Simple inline, no heavy borders -->
        <div class="meta-section">
            <div class="meta-item">
                <span class="meta-label">FACTURA Nº:</span>
                <span class="meta-value" th:text="${invoice.invoiceNumber}">001/2024</span>
            </div>
            <div class="meta-item">
                <span class="meta-label">FECHA:</span>
                <span class="meta-value"
                    th:text="${#temporals.format(invoice.issueDate, 'dd/MM/yyyy')}">01/01/2024</span>
            </div>
            <div class="meta-item" th:if="${invoice.settlementNumber}">
                <span class="meta-label">LIQUIDACIÓN Nº:</span>
                <span class="meta-value" th:text="${invoice.settlementNumber}">EXP-001</span>
            </div>
        </div>

        <!-- Client Box - Simple border -->
        <div class="client-section">
            <div class="client-title">Datos del cliente</div>
            <div class="client-content">
                <span class="client-name" th:text="${client.businessName}">Cliente</span>
                <span class="client-text" th:if="${client.taxId}" th:text="${client.taxId}">NIF</span>
                <span class="client-text"
                    th:text="${client.address + ', ' + client.postalCode + ' ' + client.city + ' - ' + client.province}">Dirección</span>
            </div>
        </div>

        <!-- Items Table -->
        <table>
            <thead>
                <tr>
                    <!-- Transport Invoice Headers -->
                    <th th:if="${isTransportInvoice}" class="col-date">FECHA</th>
                    <th th:if="${isTransportInvoice}" class="col-plate">MATRÍCULA</th>
                    <th th:if="${isTransportInvoice}" class="col-desc-transport">CONCEPTO</th>
                    <th th:if="${isTransportInvoice}" class="col-zone">ZONA</th>
                    <th th:if="${isTransportInvoice}" class="col-price-tr">PRECIO</th>
                    <th th:if="${isTransportInvoice}" class="col-gas">% GAS</th>
                    <th th:if="${isTransportInvoice}" class="col-importe-tr">IMPORTE</th>

                    <!-- Standard Invoice Headers -->
                    <th th:unless="${isTransportInvoice}" class="col-desc">Descripción producto/servicio</th>
                    <th th:unless="${isTransportInvoice}" class="col-uds">Uds</th>
                    <th th:unless="${isTransportInvoice}" class="col-dto">Dto%</th>
                    <th th:unless="${isTransportInvoice}" class="col-price">Precio</th>
                    <th th:unless="${isTransportInvoice}" class="col-iva">IVA%</th>
                    <th th:unless="${isTransportInvoice}" class="col-importe">Importe</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="item : ${invoice.items}">
                    <!-- Transport Columns -->
                    <td th:if="${isTransportInvoice}" class="col-date"
                        th:text="${item.itemDate != null ? #temporals.format(item.itemDate, 'dd/MM/yyyy') : ''}"></td>
                    <td th:if="${isTransportInvoice}" class="col-plate" th:text="${item.vehiclePlate ?: ''}"></td>
                    <td th:if="${isTransportInvoice}" class="col-desc-transport" th:text="${item.description}"></td>
                    <td th:if="${isTransportInvoice}" class="col-zone" th:text="${item.zone ?: ''}"></td>
                    <td th:if="${isTransportInvoice}" class="col-price-tr"
                        th:text="${#numbers.formatCurrency(item.price)}"></td>
                    <td th:if="${isTransportInvoice}" class="col-gas"
                        th:text="${item.gasPercentage != null ? item.gasPercentage : ''}"></td>
                    <td th:if="${isTransportInvoice}" class="col-importe-tr"
                        th:text="${#numbers.formatCurrency(item.subtotal)}"></td>

                    <!-- Standard Columns -->
                    <td th:unless="${isTransportInvoice}" class="col-desc" th:text="${item.description}"></td>
                    <td th:unless="${isTransportInvoice}" class="col-uds" th:text="${item.units}"></td>
                    <td th:unless="${isTransportInvoice}" class="col-dto"
                        th:text="${item.discountPercentage != null ? item.discountPercentage : ''}"></td>
                    <td th:unless="${isTransportInvoice}" class="col-price"
                        th:text="${#numbers.formatCurrency(item.price)}"></td>
                    <td th:unless="${isTransportInvoice}" class="col-iva" th:text="${item.vatPercentage}"></td>
                    <td th:unless="${isTransportInvoice}" class="col-importe"
                        th:text="${#numbers.formatCurrency(item.subtotal)}"></td>
                </tr>
            </tbody>
        </table>

        <!-- Footer: Observaciones + Totals -->
        <div class="footer-section">
            <div class="observaciones">
                <span class="observaciones-label">Observaciones / Datos de pago:</span>
                <span th:if="${company.iban}" class="observaciones-text"
                    th:text="'IBAN: ' + ${company.iban}">IBAN</span>
                <span th:if="${invoice.notes}" class="observaciones-text" th:text="${invoice.notes}">Notas</span>
            </div>

            <div class="totals-box">
                <div class="total-row">
                    <span class="total-label">Base imponible:</span>
                    <span class="total-value" th:text="${#numbers.formatCurrency(invoice.baseAmount)}">0,00 €</span>
                </div>
                <div class="total-row">
                    <span class="total-label" th:text="'IVA (' + ${invoice.items[0].vatPercentage} + '%):'">IVA
                        (21%):</span>
                    <span class="total-value"
                        th:text="${#numbers.formatCurrency(invoice.totalAmount - invoice.baseAmount + invoice.irpfAmount - invoice.reAmount)}">0,00€</span>
                </div>
                <div class="total-row" th:if="${invoice.rePercentage > 0}">
                    <span class="total-label" th:text="'RE (' + ${invoice.rePercentage} + '%):'">RE</span>
                    <span class="total-value" th:text="${#numbers.formatCurrency(invoice.reAmount)}">0,00 €</span>
                </div>
                <div class="total-row" th:if="${invoice.irpfPercentage > 0}">
                    <span class="total-label" th:text="'IRPF (' + ${invoice.irpfPercentage} + '%):'">IRPF</span>
                    <span class="total-value"
                        th:text="'-' + ${#numbers.formatCurrency(invoice.irpfAmount)}">0,00€</span>
                </div>
                <div class="grand-total">
                    <span class="grand-total-label">TOTAL:</span>
                    <span class="grand-total-value"
                        th:text="${#numbers.formatCurrency(invoice.totalAmount)}">0,00€</span>
                </div>
            </div>
        </div>

        <!-- VeriFactu Footer -->
        <div class="verifactu-footer">
            <span>Factura verificable en la sede electrónica de la AEAT - VERI*FACTU</span>
        </div>
    </div>
</body>

</html>